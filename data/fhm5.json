{"name":"fhm5","title":"Sepia Filter","description":"","libraries":[],"js":{"language":"js","content":"// forked from svggirl's \"ShuffleColorFilter\" http://jsdo.it/svggirl/svg_sample_filter\n/*\n\nHow to use\n\nThis code is loaded before SVG animation, and run on same domain with SVG animation playing code, in the below order.\n\n1. filter.each_text(svg_text, n)\n2. filter.each_node(svg_node, n)\n3. filter.complete(svg_node)\n\nEach method is called with following timing.\n\n* filter.each_text(svg_text, n)\nCalled before SVG text is loaded and added to DOM. svg_text is SVG text value, while n is current frame number.\n(however, since background SVG is loading at the same time, frame number and played number is not equal)\nAfter modifying svg_text, it is necessary to return the return value. There is no inline SVG support, thus it's impossible to call from browser.\n\n* filter.each_node(svg_node, n)\nSVG element is called whenever it is read. \nSVG element is given on svg_node, and n gives frame number.\n(however, since background SVG is loading at the same time, frame number and played number is not equal)\nThe return value is dropped to enable direct modification on SVG element.\nIt could be called on most of browser that handle SVG.\n\n* filter.complete(svg_node, background_node)\nIt's called after all SVG elements are loaded.\nNew elemtn where video SVG element is compiled is given to svg_node, whereas new element with compiled background SVG element is given to background_node.\nThe return value is dropped to enable direct modification on SVG element.\nIt could be called on most of browser that handle SVG.\n\n*/\n\nif (typeof filter === 'undefined') {\n    var filter = {};\n};\nfilter.each_text = function(svg_text, n) {\n  var color = /#(\\w\\w?)(\\w\\w?)(\\w\\w?)/g;\n  var colors = svg_text.match(color);\n  var count = colors.length - 1;\n  if (!colors.length) return svg_text;\n\n  var text = svg_text.replace(color, sepia);\n  return text;\n};\n\nfunction sepia(m, r, g, b){\n  var color = [r, g, b];\n  for(var i = 0; i < 3; i++){\n    var c = color[i];\n    if(c.length == 1) c += c;\n    color[i] = parseInt(c, 16);\n  }\n  var y = color[0] * 0.30 + color[1] * 0.59 + color[2] * 0.11;\n  color[0] = y * 1.00 |0;\n  color[1] = y * 0.75 |0;\n  color[2] = y * 0.55 |0;\n  return 'rgb(' + color.join(',') + ')';\n}\n\nfilter.each_text.random = function(max) {\n  return Math.floor(Math.random() * (max + 1));\n};\n\n\nfilter.each_node = function(svg_node, n) {\n  log(n);\n};\n\nfilter.complete = function(svg_node) {\n  log('complete! total: '+svg_node.length);\n};\n\n"},"html":{"language":"html","content":"<div id=\"svg\"></div>\n\n<script src=\"http://ajax.microsoft.com/ajax/jquery/jquery-1.4.2.min.js\"></script>\n<script src=\"http://jsdo.it/event/ie9/js/config.js\"></script>\n<script src=\"http://jsdo.it/event/ie9/js/preview.js\"></script>\n\n"},"css":{"language":"css","content":"html, body {\n  margin: 0;\n  padding: 0;\n}\n\nbody {\n  background-color: #fff;\n}\n\n#svg {\n  display: none;\n  overflow: hidden;\n  width: 465px;\n  height: 262px;\n}\n\nsvg {\n  vertical-align: middle;\n}\n\n"},"published":"2011-04-16T12:40:47"}