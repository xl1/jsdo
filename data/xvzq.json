{"name":"xvzq","title":"CSS Shaders を WebGL でシミュレートする","description":"<div class=\"markdown\"><ul>\n<li><a href=\"http://jsdo.it/xl1/7iMb\">&#x30DA;&#x30FC;&#x30B8;&#x3050;&#x3061;&#x3083;&#x3050;&#x3061;&#x3083;&#x306B;&#x3059;&#x308B;&#x3084;&#x3064;</a> &#x3092;&#x3064;&#x304F;&#x308B;&#x3068;&#x304D;&#x306B;&#x3001;GLSL &#x3092;&#x30C7;&#x30D0;&#x30C3;&#x30B0;&#x3059;&#x308B;&#x5FC5;&#x8981;&#x304C;&#x3042;&#x3063;&#x305F;</li>\n<li><a href=\"http://jsdo.it/xl1/2Ckz\">http://jsdo.it/xl1/2Ckz</a> &#x3092;&#x4F7F;&#x3063;&#x3066; CSS custom filter &#x3068;&#x540C;&#x3058;&#x3053;&#x3068;&#x3092; WebGL &#x3067;&#x3057;&#x305F;</li>\n<li>GLSL &#x306E;&#x30C7;&#x30D0;&#x30C3;&#x30B0;&#x304C;&#x3067;&#x304D;&#x308B;&#x306E;&#x3067;&#x5B09;&#x3057;&#x3044;</li>\n<li><a href=\"http://html2canvas.hertzen.com/\">html2canvas</a>&#x3092;&#x4F7F;&#x3046;&#x3068;&#x5B9F;&#x969B;&#x306B;&#x8981;&#x7D20;&#xFF08;&#x306E;&#x7D75;&#xFF09;&#x3092;&#x3044;&#x3058;&#x308B;&#x3053;&#x3068;&#x3082;&#x3067;&#x304D;&#x308B;&#x306E;&#x3067;&#x306F; &#x2192; <em>2012/10/15&#x8FFD;&#x8A18;</em> <a href=\"http://jsdo.it/xl1/ahmy\">http://jsdo.it/xl1/ahmy</a></li>\n<li><em>2012/10/24 &#x8FFD;&#x8A18;</em> <a href=\"http://experiments.hertzen.com/css-shaders/\">http://experiments.hertzen.com/css-shaders/</a> &#x3092;&#x4F7F;&#x3063;&#x305F;&#x307B;&#x3046;&#x304C;&#x4FBF;&#x5229;</li>\n<li><em>2013/09/26 &#x66F4;&#x65B0;</em> Chrome WebGL &#x306E;&#x5B9F;&#x88C5;&#x5909;&#x66F4;&#x3067; uniform &#x306E; precision &#x3092;&#x63C3;&#x3048;&#x306A;&#x3044;&#x3068;&#x3044;&#x3051;&#x306A;&#x304F;&#x306A;&#x3063;&#x3066;&#x305F;&#x306E;&#x3067;&#x63C3;&#x3048;&#x305F;</li>\n</ul>\n</div>","libraries":["/xl1/eHqL","/xl1/2Ckz"],"js":{"language":"coffeescript","content":"$text = (id) -> document.getElementById(id).textContent\n\nfilter = (new CustomFilterGL)\n    .source('../assets/5NHs1.jpg')\n    .shader($text('vshader'), $text('fshader'), true, 'normal', 'source-atop')\n    .mesh(16, 16, 'filter-box', true)\n    .draw()\n\nsetInterval ->\n    filter.uniforms( seed: [Date.now() % 3e+4, Date.now() % 12345] ).draw()\n, 2000\n\n###\ncustom(\n\turl(#vshader) mix(url(#fshader) normal source-atop),\n\t16 16 filter-box detached,\n\tseed *** ***\n)\nに相当する\n###"},"html":{"language":"html","content":"<script type=\"x-shader/x-vertex\" id=\"vshader\">\nprecision mediump float;\nattribute vec4 a_position;\nattribute vec3 a_triangleCoord;\nuniform vec2 u_meshSize;\nuniform mat4 u_projectionMatrix;\nvarying float v_diff;\n\nuniform vec2 seed;\nfloat seed1 = seed.x, seed2 = seed.y;\n\nvoid nextSeed(inout float s, float modulo, float a, float b){\n  s = mod(a * s + b, modulo);\n}\nfloat rand1(){\n  nextSeed(seed1, 65537.0, 11366.0, 12345.0);\n  return seed1 / 65537.0;\n}\nfloat rand2(){\n  nextSeed(seed2, 32771.0, 7524.0, 4567.0);\n  return seed2 / 32771.0;\n}\n\nvoid main(){\n  const int loopMax = 1000;\n  \n  float diff = 0.0;\n  float width = u_meshSize.x;\n  float density = 0.7 / width;\n  int index = int(a_triangleCoord.y * width);\n  \n  for(int i = 0; i < loopMax; i++){\n    if(i == index) break;\n    if(rand1() < density){\n      diff += rand2() * width;\n    }\n  }\n  diff = floor(diff);\n  v_diff = diff;\n  float gap = a_position.x - a_triangleCoord.x / width;\n  gl_Position = u_projectionMatrix * vec4(\n    fract((a_triangleCoord.x + diff) / width) + gap,\n    a_position.y,\n    0.0,\n    1.0\n  );\n}\n</script>\n<script type=\"x-shader/x-fragment\" id=\"fshader\">\nprecision mediump float;\nvarying float v_diff;\n\nuniform vec2 seed;\nfloat seed1 = seed.x, seed2 = seed.y;\n\nvoid nextSeed(inout float s, float modulo, float a, float b){\n  s = mod(a * s + b, modulo);\n}\nfloat rand1(){\n  nextSeed(seed1, 65537.0, 11367.0, 12345.0);\n  return seed1 / 65537.0;\n}\nfloat rand2(){\n  nextSeed(seed2, 32771.0, 7529.0, 4545.0);\n  return seed2 / 32771.0;\n}\n\nfloat val(){\n  const float density = 0.2;\n\n  if(rand1() < density) return rand2();\n  return 0.0;\n}\n\nvoid main(){\n  const int loopMax = 1000;\n  \n  int index = int(mod(v_diff, float(loopMax)));\n  for(int i = 0; i < loopMax; i++){\n    if(i == index) break;\n    rand1(); rand2();\n  }\n  \n  css_ColorMatrix = mat4(\n    1.0 - val(), val(), val(), 0.0,\n    val(), 1.0 - val(), val(), 0.0,\n    val(), val(), 1.0 - val(), 0.0,\n    val(), val(), val(), 1.0\n  );\n}\n</script>"},"css":{"language":"css","content":""},"published":"2013-09-26T04:11:43"}