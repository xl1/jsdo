{"name":"5cko","title":"JavaScript (CSS automata) generator","description":"&#x5168;&#x753B;&#x9762;&#x30E2;&#x30FC;&#x30C9;&#x3067;&#x307F;&#x305F;&#x307B;&#x3046;&#x304C;&#x3044;&#x3044;&#x3067;&#x3059;&#x3002;<a href=\"http://jsdo.it/xl1/5cko/fullscreen\">http://jsdo.it/xl1/5cko/fullscreen</a><br>\n<br>\nCSS &#x3067;&#x3067;&#x304D;&#x305F;&#x30AA;&#x30FC;&#x30C8;&#x30DE;&#x30C8;&#x30F3;&#x306E;&#x30B7;&#x30DF;&#x30E5;&#x30EC;&#x30FC;&#x30BF;&#xFF08; <a href=\"http://jsdo.it/xl1/lP5j\">http://jsdo.it/xl1/lP5j</a> &#x307F;&#x305F;&#x3044;&#x306A;&#x306E;&#xFF09;&#x3092;&#x3064;&#x304F;&#x308B;&#x3002;<br>\n&#x72B6;&#x614B;&#x9077;&#x79FB;&#x8868;&#x3092;&#x66F8;&#x3044;&#x3066;&#x300C;&#x25BC; &#x751F;&#x6210;&#x3059;&#x308B; &#x25BC;&#x300D;&#x3092;&#x62BC;&#x3059;&#x3002;<br>\n&#x7DBA;&#x9E97;&#x306B;&#x6574;&#x5F62;&#x30FB;&#x30C7;&#x30B6;&#x30A4;&#x30F3;&#x3059;&#x308C;&#x3070;&#x6C17;&#x306E;&#x304D;&#x3044;&#x305F;UI&#x3068;&#x304B;&#x7C21;&#x5358;&#x306A;&#x30B2;&#x30FC;&#x30E0;&#x3068;&#x304B;&#x3067;&#x304D;&#x308B;&#x3093;&#x3058;&#x3083;&#x306A;&#x3044;&#x3067;&#x3057;&#x3087;&#x3046;&#x304B;<br>\n<br>\n&#x4F8B;1 &#x306F; <a href=\"http://d.hatena.ne.jp/m-hiyama/20100607/1275869841\">http://d.hatena.ne.jp/m-hiyama/20100607/1275869841</a><br>\n&#x4F8B;2 &#x306F; <a href=\"http://lecture.ecc.u-tokyo.ac.jp/johzu/joho/Y2010/Automaton/Automaton/automaton_5.html\">http://lecture.ecc.u-tokyo.ac.jp/johzu/joho/Y2010/Automaton/Automaton/automaton_5.html</a> &#x306E; Exercise 7<br>\n&#x3092;&#x53C2;&#x8003;&#x306B;&#x3057;&#x3066;&#x3044;&#x307E;&#x3059;","libraries":["/lib/jquery-1.6.0"],"js":{"language":"js","content":"/* --- data --- */\nvar exampleData = [{\n  name: '例1: 正規表現 /^aa?b*c$/',\n  numOpr: 4,\n  numOut: 1,\n  operations: 'a\\nb\\nc\\nEOS',\n  outputs: 'state',\n  data: '\\t1\\t2\\t3\\t4\\t1\\n' +\n    '1\\t2\\t5\\t5\\t5\\t1\\n' +\n    '2\\t3\\t3\\t4\\t5\\t2\\n' +\n    '3\\t5\\t3\\t4\\t5\\t3\\n' +\n    '4\\t5\\t5\\t5\\t6\\t4\\n' +\n    '5\\t-\\t-\\t-\\t-\\t5(error)\\n' +\n    '6\\t-\\t-\\t-\\t-\\t6(accept)'\n}, {\n  name: '例2: 自動販売機',\n  numOpr: 4,\n  numOut: 2,\n  operations:\n    '100円投入\\n' +\n    '50円投入\\n' +\n    '購入\\n' +\n    'お釣り',\n  outputs: '内部\\n排出',\n  data: '\\t1\\t2\\t3\\t4\\t1\\t2\\n' +\n    '1\\t3\\t2\\t-\\t-\\t0円\\t\\n' +\n    '2\\t4\\t3\\t-\\t6\\t50円\\t\\n' +\n    '3\\t5\\t4\\t-\\t7\\t100円\\t\\n' +\n    '4\\t-\\t5\\t10\\t8\\t150円\\t\\n' +\n    '5\\t-\\t-\\t11\\t9\\t200円\\t\\n' +\n    '6\\t3\\t2\\t1\\t1\\t0円\\t50円\\n' +\n    '7\\t3\\t2\\t1\\t1\\t0円\\t100円\\n' +\n    '8\\t3\\t2\\t1\\t1\\t0円\\t150円\\n' +\n    '9\\t3\\t2\\t1\\t1\\t0円\\t200円\\n' +\n    '10\\t3\\t2\\t1\\t1\\t0円\\tジュース\\n' +\n    '11\\t4\\t3\\t2\\t6\\t50円\\tジュース'\n}, {\n  name: '例3: ゲームブックのようなもの',\n  numOpr: 2,\n  numOut: 1,\n  operations: 'A\\nB',\n  outputs: '>',\n  data: '\\t1\\t2\\t1\\n' +\n    '1\\t16\\t8\\t君は大きな洞窟の中にいる。目の前に道がふたつ続いている。\\\\A ' +\n      'A: 右へ進む\\\\A B: 左へ進む\\n' +\n    '2\\t1\\t1\\tそれから10日、君は痛みと脱水に苦しみながら息を引き取った。\\\\A Game over\\n' +\n    '3\\t17\\t17\\t尻尾を切られたドラゴンは叫び声をあげてぐったり横たわる。やった、倒したぞ！\\\\A ' +\n      'A,B: 次へ\\n' +\n    '4\\t12\\t7\\t小人「ここはぼくたちの土地だ。この先には進ませないよ。」\\\\A ' +\n      'A: 戦う\\\\A B: 諦めて戻る\\n' +\n    '5\\t10\\t13\\tドラゴンのいる向こう側に出口が見える。どうにかして通り抜けるしかない。\\\\A ' +\n      'A: 戦う\\\\A B: こっそり通り抜ける\\n' +\n    '6\\t2\\t2\\t君は大穴に気づかず落ちて、足を折ってしまった。\\\\A ' +\n      'A,B: 次へ\\n' +\n    '7\\t9\\t1\\tおや、さっきは気付かなかったが、天井にぽっかり穴が開いている。\\\\A ' +\n      'A: 穴を登る\\\\A B: 無視\\n' +\n    '8\\t12\\t4\\tしばらく歩いていると、君の前に小人（こびと）があらわれた。\\\\A ' +\n      'A: 戦う\\\\A B: 話をする\\n' +\n    '9\\t13\\t5\\tなんと、そこはドラゴンの巣になっていた！ドラゴンに見つかる前に逃げなくては……\\\\A ' +\n      'A: 戻る\\\\A B: 他の逃げ道を探す\\n' +\n    '10\\t15\\t3\\tさあ、君はドラゴンの……\\\\A ' +\n      'A: 頭を攻撃\\\\A B: 尻尾を攻撃\\n' +\n    '11\\t14\\t14\\t音がどんどん近づいてくる。後ろを振り向くと、大蛇の舌が迫ってきている！\\\\A ' +\n      'A: 急いで進む\\\\A B: 慎重に進む\\n' +\n    '12\\t1\\t1\\t小人が口笛を吹き、君はいつの間にか小人の大群に囲まれていたことに気づく。君は捕まった。\\\\A Game over\\n' +\n    '13\\t15\\t15\\t駄目だ、君は気づかれてしまった。\\\\A ' +\n      'A,B: 逃げる\\n' +\n    '14\\t1\\t1\\t間に合わなかった。君は一飲みにされて死んだ。\\\\A Game over\\n' +\n    '15\\t1\\t1\\t君は怒ったドラゴンの炎に全身を包まれて死んだ。\\\\A Game over\\n' +\n    '16\\t6\\t11\\t歩いていると、後ろのほうからなにかを引きずるような音が聞こえてくる。\\\\A ' +\n      'A: 急いで進む\\\\A B: 慎重に進む\\n' +\n    '17\\t1\\t1\\t君は目を覚ます。どうやら、すべて夢だったようだ……。\\\\A Fin.'\n}];\n    \n/* --- --- --- */\n\ninit();\n\nfunction init(){\n  var defaultCss = '\\\n#result input {\\n\\\n\\tdisplay: none;\\n\\\n}\\n\\\n#panel {\\n\\\n\\tposition: relative;\\n\\\n}\\n\\\n#panel label {\\n\\\n\\tdisplay: none;\\n\\\n\\tposition: absolute;\\n\\\n\\tleft: 0;\\n\\\n\\ttop: 0;\\n\\\n\\tz-index: 2;\\n\\\n\\tbackground: #fff;\\n\\\n\\topacity: .1;\\n\\\n}\\n\\\n#panel .button, #panel label {\\n\\\n\\twidth: 100px;\\n\\\n\\theight: 25px;\\n\\\n\\tmargin: 0;\\n\\\n\\tcursor: pointer;\\n\\\n}\\n\\\n#panel .button {\\n\\\n\\tdisplay: inline-block;\\n\\\n\\ttext-align: center;\\n\\\n\\tbackground: #eee;\\n\\\n\\tborder-bottom: 2px solid #aaa;\\n\\\n\\tborder-right: 2px solid #aaa;\\n\\\n\\tbox-sizing: border-box;\\n\\\n}\\n\\\n#panel .output {\\n\\\n\\twhite-space: pre-line;\\n\\\n}\\n\\n';\n\n  var dataArea = $('#data');\n  dataArea.keydown(enableTab);\n  var examples = $('#examples');\n  examples.change(setExamples);\n  prepareExamples();\n  setExamples();\n  \n  $('#generateButton').click(generate);\n  $('#numOperations, #numOutputs').bind('input', setColumns);\n  \n  function prepareExamples(){\n    for(var i = 0; i < exampleData.length; i++){\n      examples.append(\n        $('<option>').text(exampleData[i].name)\n      );\n    }\n  }\n  \n  function setExamples(){\n    var ex = exampleData[examples[0].selectedIndex];\n    $('#numOperations').val(ex.numOpr);\n    $('#numOutputs').val(ex.numOut);\n    $('#operations').val(ex.operations);\n    $('#outputs').val(ex.outputs);\n    dataArea.val(ex.data);\n  }\n  \n  function setColumns(){\n    var numOpr = $('#numOperations').val() -0;\n    var numOut = $('#numOutputs').val() -0;\n    if(isNaN(numOpr) || isNaN(numOut)) return;\n    var data = dataArea.val();\n    \n    dataArea.val(data.replace(/.*?(\\n|\\r)+/, function(m, m1){\n      var res = new Array(1);\n      for(var i = 1; i <= numOpr; i++) res.push(i);\n      for(    i = 1; i <= numOut; i++) res.push(i);\n      return res.join('\\t') + m1;\n    }));\n  }\n  \n  function generate(){\n    var numOpr = $('#numOperations').val() -0;\n    var numOut = $('#numOutputs').val() -0;\n    if(isNaN(numOpr) || isNaN(numOut)) return;\n    var val = dataArea.val().split(/[\\n\\r]+/);\n    var obj = val.map(function(e){\n      return e.split('\\t');\n    });\n    \n    var r, c, num;\n    \n    // generate CSS\n    var css = [defaultCss];\n    for(c = 1; c <= numOpr; c++){\n      var cssb = [];\n      for(r = 1; r < obj.length; r++){\n        num = obj[r][c] -0;\n        if(!isNaN(num) && r !== num)\n          cssb.push('#i'+r+':checked ~ #panel #l'+num+'_'+c);\n      }\n      if(cssb.length){\n        css.push(\n          cssb.join(',\\n') +\n          ' {\\n\\tdisplay: block; left: ' + 100*(c-1) + 'px;\\n}'\n        );\n      }\n    }\n    for(c = 1; c <= numOut; c++){\n    for(r = 1; r < obj.length; r++){\n      var content = obj[r][numOpr + c];\n      if(content){\n        css.push(\n          '#i'+r+':checked ~ #panel #o'+c+'::after' +\n          ' { content: \"'+content+'\"; }'\n        );\n      }\n    }}\n    \n    // generate HTML\n    var html = ['<div id=\"result\">'];\n    for(r = 1; r < obj.length; r++){\n      var radio = '<input type=\"radio\" name=\"state\" id=\"i'+r+'\"' +\n        (r === 1 ? ' checked' : '') +\n        '>';\n      html.push(radio);\n    }\n    html.push('<div id=\"panel\">');\n    for(c = 1; c <= numOpr; c++){\n      var chk = new Array(obj.length);\n      for(r = 1; r < obj.length; r++){\n        num = obj[r][c] -0;\n        if(!isNaN(num) && !chk[num]){\n          html.push('<label for=\"i'+num+'\" id=\"l'+num+'_'+c+'\"></label>');\n          chk[num] = true;\n        }\n      }\n    }\n    var opr = $('#operations').val().split(/[\\n\\r]+/).map(htmlEscape);\n    var out = $('#outputs').val().split(/[\\n\\r]+/).map(htmlEscape);\n    for(var i = 0; i < numOpr; i++)\n      html.push('<div class=\"button\">' + opr[i] + '</div>');\n    for(    i = 0; i < numOut; i++)\n      html.push('<div class=\"output\" id=\"o'+(i+1)+'\">' + out[i] + ': </div>');\n      \n    html.push('</div>'); // end of #panel\n    html.push('</div>'); // end of #result\n    \n    // output CSS and HTML\n    var cssText = css.join('\\n');\n    var htmlText = html.join('\\n');\n    $('#resultStyle').text(cssText);\n    //$('#result')[0].outerHTML = htmlText; // Firfox doesnt support outerHTML\n    $('#result').before(htmlText).remove();\n    $('#resultCss').val(cssText);\n    $('#resultHtml').val(htmlText);\n  }\n}\n\nfunction enableTab(e){\n  var TAB = '\\t';\n  if(String.fromCharCode(e.keyCode) !== TAB) return;\n  if(e.shiftKey) return;\n  var val = this.value;\n  var ss = this.selectionStart, se = this.selectionEnd;\n  this.value = val.substring(0, ss) + TAB + val.substring(se);\n  this.focus();\n  this.selectionStart = ss + TAB.length;\n  this.selectionEnd = se + TAB.length;\n  e.preventDefault();\n}\nfunction htmlEscape(str){\n  var refs = {\n    '&': '&amp;',  '<': '&lt;',   '>': '&gt;',\n    \"'\": '&apos;', '\"': '&quot;', ' ': '&nbsp;'\n  };\n  return str.replace(/[<>&'\" ]/g, function(s){ return refs[s]; });\n}"},"html":{"language":"html","content":"<style id=\"resultStyle\"></style>\n<form>\n  <div>\n    <select id=\"examples\" size=\"1\"></select>\n    <label>操作の数:<input type=\"number\" id=\"numOperations\" min=\"0\"></label>\n    <label>出力の数:<input type=\"number\" id=\"numOutputs\" min=\"0\"></label>\n  </div>\n  <textarea id=\"operations\"></textarea>\n  <textarea id=\"outputs\"></textarea>\n  <textarea id=\"data\"></textarea>\n  <input type=\"button\" value=\" ▼ 生成する ▼ \" id=\"generateButton\">\n  <hr>\n  <div>生成された CSS と HTML:</div>\n  <textarea id=\"resultCss\"></textarea>\n  <textarea id=\"resultHtml\"></textarea>\n  <div class=\"dummy\"></div>\n</form>\n<div id=\"result\">（ここにシミュレータができる）</div>"},"css":{"language":"css","content":"form textarea {\n  display: block;\n  box-sizing: border-box;\n  -moz-box-sizing: border-box;\n  height: 200px;\n  float: left;\n}\nform textarea + :not(textarea) {\n  display: block;\n  clear: both;\n}\n#operations, #outputs {\n  width: 16%;\n}\n#data {\n  width: 68%;\n}\n#resultCss, #resultHtml {\n  width: 50%;\n  height: 100px;\n}\n#result {\n  border: 1px solid #ccc;\n  margin: 5px 0;\n  padding: 5px;\n}"},"published":"2011-06-12T22:19:19"}