{"name":"tw7h","title":"forked: iOS4.2～の加速度、ジャイロを使ったcanvasの描画","description":"addEventListener &#x306E;&#x7B2C;&#x4E09;&#x5F15;&#x6570;&#x3092;&#x6307;&#x5B9A;&#x3059;&#x308B;&#x3068; Android &#x7248; Opera Mobile &#x306E;&#x30D7;&#x30EC;&#x30D3;&#x30E5;&#x30FC;&#x7248;<br>\n<a href=\"http://my.opera.com/core/blog/2011/03/23/webcam-orientation-preview\">http://my.opera.com/core/blog/2011/03/23/webcam-orientation-preview</a><br>\n&#x3067;&#x3082;&#x52A0;&#x901F;&#x5EA6;&#x3092;&#x3068;&#x308B;&#x3053;&#x3068;&#x304C;&#x3067;&#x304D;&#x307E;&#x3057;&#x305F;<br>\nHTC Desire + Android 2.2 &#x3067;&#x78BA;&#x8A8D;","libraries":[],"js":{"language":"js","content":"// forked from kyo_ago's \"iOS4.2～の加速度、ジャイロを使ったcanvasの描画\" http://jsdo.it/kyo_ago/126r\n// forked from alt's \"iOS4.2～の加速度センサー、ジャイロセンサーの取得\" http://jsdo.it/alt/YkYd\n\nvar devicemotion = {\n    // iPhone4 and iPhone3GS and iPhone3G\n    'accelerationIncludingGravity' : {\n    \t'x' : undefined,\n\t\t'y' : undefined,\n\t\t'z' : undefined\n\t},\n\t// iPhone4 only\n\t'acceleration' : {\n\t\t'x' : undefined,\n\t\t'y' : undefined,\n\t\t'z' : undefined\n\t},\n\t// iPhone4 only\n\t'rotationRate' : {\n\t\t'alpha' : undefined,\n\t\t'beta' : undefined,\n\t\t'gamma' : undefined\n\t}\n};\n\nvar cursorPosition = {\n\t'x' : undefined,\n\t'y' : undefined\n};\n\n(function () {\n\tvar canvas = document.getElementsByTagName('canvas')[0];\n\tcanvas.width = window.innerWidth;\n\tcanvas.height = window.innerHeight;\n\tvar ctx = canvas.getContext('2d');\n\tctx.globalCompositeOperation = 'source-over';\n\tctx.fillStyle = 'rgba(0, 0, 0, 0)';\n\tctx.fillRect(0, 0, canvas.width, canvas.height);\n\tctx.globalCompositeOperation = 'lighter';\n\tvar center = {\n\t\t'x' : canvas.width / 2,\n\t\t'y' : canvas.height / 2\n\t};\n\n\t(function updateAnimation () {\n\t\tctx.clearRect(0, 0, canvas.width, canvas.height);\n\n\t\tvar x = devicemotion.accelerationIncludingGravity.x || cursorPosition.x || 0;\n\t\tvar y = devicemotion.accelerationIncludingGravity.y || cursorPosition.y || 0;\n\t\t//accelerationIncludingGravityの値が小さいので100倍する\n        //(大きすぎる値はColorHSVで丸められる)\n        x *= 100;\n\t\ty *= 100;\n\n\t\t//グラデーション\n        var grad = ctx.createRadialGradient(center.x, center.y, 0, center.x, center.y, center.x);\n\t\tvar start = ColorHSV(x);\n\t\tvar stop = ColorHSV(y);\n\t\tgrad.addColorStop(0, 'rgba('+start.join(', ')+', 1)');\n\t\tgrad.addColorStop(1, 'rgba('+stop.join(', ')+', 0)');\n\t\tctx.fillStyle = grad;\n\t\tctx.fillRect(0, 0, canvas.width, canvas.height);\n\n\t\tsetTimeout(updateAnimation, 200);\n\t})();\n})();\n\nwindow.addEventListener('devicemotion', function(evt) {\n\tdevicemotion.acceleration = evt.acceleration;\n\tdevicemotion.accelerationIncludingGravity = evt.accelerationIncludingGravity;\n\tdevicemotion.rotationRate = evt.rotationRate;\n}, false);\n\nwindow.addEventListener('deviceorientation', function(evt) {\n\tdevicemotion.rotationRate = evt.rotationRate;\n}, false);\n// for PC\nwindow.addEventListener('MozOrientation', function(evt) {\n    devicemotion.acceleration = { 'x' : evt.x, 'y' : evt.y };\n}, false);\nwindow.addEventListener('mousemove', function(evt) {\n\tcursorPosition.x = evt.clientX;\n\tcursorPosition.y = evt.clientY;\n}, false);\n\n// from Frocessing\nfunction ColorHSV (h) {\n\tvar ht = h;\n\tvar _v = 1.0, _s = 1.0;\n\tht = (((ht %= 360) < 0) ? ht + 360 : ht ) / 60;\n\tvar vt = Math.max( 0, Math.min( 0xff, _v * 0xff ) );\n\tvar hi = Math.floor( ht );\n\tvar _r, _g, _b;\n \n\tswitch (hi) {\n\t\tcase 0:\n\t\t\t_r = vt;\n\t\t\t_g = Math.round( vt * ( 1 - (1 - ht + hi) * _s ) );\n\t\t\t_b = Math.round( vt * ( 1 - _s ) );\n\t\t\tbreak;\n\t\tcase 1:\n\t\t\t_r = Math.round( vt * ( 1 - _s * ht + _s * hi ) );\n\t\t\t_g = vt;\n\t\t\t_b = Math.round( vt * ( 1 - _s ) );\n\t\t\tbreak;\n\t\tcase 2:\n\t\t\t_r = Math.round( vt * ( 1 - _s ) );\n\t\t\t_g = vt;\n\t\t\t_b = Math.round( vt * ( 1 - (1 - ht + hi) * _s ) );\n\t\t\tbreak;\n\t\tcase 3:\n\t\t\t_r = Math.round( vt * ( 1 - _s ) );\n\t\t\t_g = Math.round( vt * ( 1 - _s * ht + _s * hi ) );\n\t\t\t_b = vt;\n\t\t\tbreak;\n\t\tcase 4:\n\t\t\t_r = Math.round( vt * ( 1 - (1 - ht + hi) * _s ) );\n\t\t\t_g = Math.round( vt * ( 1 - _s ) );\n\t\t\t_b = vt;\n\t\t\tbreak;\n\t\tcase 5:\n\t\t\t_r = vt;\n\t\t\t_g = Math.round( vt * ( 1 - _s ) );\n\t\t\t_b = Math.round( vt * ( 1 - _s * ht + _s * hi ) );\n\t\t\tbreak;\n\t}\n\treturn [_r, _g, _b];\n}\n"},"html":{"language":"html","content":"<canvas></canvas>"},"css":{"language":"css","content":"body { background-color: #DDDDDD; font: 12px sans-serif; }"},"published":"2011-07-28T20:23:04"}