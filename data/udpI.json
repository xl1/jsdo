{"name":"udpI","title":"hanabimap","description":"jsdo.it API <a href=\"http://jsdo.it/apidoc/code.html#code-search\">http://jsdo.it/apidoc/code.html#code-search</a><br>\nGoogle Maps Javascript API <a href=\"http://code.google.com/apis/maps/documentation/javascript/\">http://code.google.com/apis/maps/documentation/javascript/</a><br>\n<br>\n&#x3046;&#x3064;&#x304F;&#x3057;&#x304F;&#x898B;&#x3048;&#x306A;&#x3044;&#x3057;&#x3001;&#x91CD;&#x3059;&#x304E;&#x308B;<br>\n&#x3069;&#x3046;&#x306B;&#x304B;&#x3057;&#x305F;&#x3044;","libraries":[],"js":{"language":"js","content":"var API = 'http://api.jsdo.it/v0.2/code/search.json';\nvar IFRAME_SIZE = 465;\nvar NUM_HANABI = 8;\n\nvar map;\n\nsetupMap();\nsetupHanabi();\n\nfunction setupMap(){\n  map = new google.maps.Map(document.getElementById('map_canvas'), {\n    center: new google.maps.LatLng(0, 0),\n    zoom: 2,\n    mapTypeControl: false,\n    backgroundColor: 'black'\n  });\n  map.mapTypes.set('background', new google.maps.ImageMapType({\n    minZoom: 2,\n    maxZoom: 6,\n    tileSize: new google.maps.Size(256, 256),\n    getTileUrl: function(){\n      return 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAIAAACQd' +\n      '1PeAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQ' +\n      'AAAAMSURBVBhXY2BgYAAAAAQAAVzN/2kAAAAASUVORK5CYII=';\n    }\n  }));\n  map.setMapTypeId('background');\n}\n\nfunction setupHanabi(){\n  var hanabis = [];\n  var showed = 0;\n  var lastPage = 0;\n  getHanabi();\n  for(var i = NUM_HANABI; i--;) setTimeout(drawHanabi, (i + 1) * 1000);\n\n  function getHanabi(func){\n    var apiurl = API + '?tag=hanabi&page=' + (++lastPage);\n    var xhr = new XMLHttpRequest();\n    xhr.open('GET', apiurl, true);\n    xhr.onload = function(){\n      var response = xhr.responseText;\n      var data;\n      try{ data = JSON.parse(response); } catch(e) { return; }\n      if(!data.results || !data.results.length) return;\n      hanabis = hanabis.concat(data.results);\n    };\n    xhr.send(null);\n  }\n\n  function drawHanabi(old){\n    if(old){\n      old.remove();\n      old = null;\n    }\n    var interval = Math.random() * 2000 + 6000;\n\n    var index = Math.random() * hanabis.length |0;\n    var hanabi = hanabis[index];\n    var url = hanabi.url.replace('jsdo', 'jsrun');\n\n    var s = Math.random() * 40 + 80;\n    var x = Math.random() * 360;\n    var y = Math.random() * 60 - s;\n    var ol = new Overlay(map, url, x, y, s);\n\n    if(++showed % 20 === 0) getHanabi();\n    setTimeout(function(){ drawHanabi(ol); }, interval);\n  }\n}\n\nfunction Overlay(map, src, x, y, size){\n  var iframe = document.createElement('iframe');\n  iframe.src = src;\n  iframe.width = iframe.height = IFRAME_SIZE;\n  iframe.scrolling = 'no';\n  iframe.style.position = 'absolute';\n  iframe.style.opacity = '0';\n  iframe.style.border = '0';\n  iframe.style.outline = '0';\n  iframe.style.zIndex = '-1';\n  ['WebkitT', 'MozT', 'MsT', 'OT', 't'].forEach(function(x){\n    iframe.style[x + 'ransformOrigin'] = '0 0';\n  });\n  iframe.onload = function(){\n    this.style.opacity = '1';\n  };\n  this.iframe = iframe;\n  this.west = new google.maps.LatLng(-y, x);\n  this.east = new google.maps.LatLng(-y, x + size);\n  this.setMap(map);\n}\n(function(){\n  Overlay.prototype = new google.maps.OverlayView();\n  Overlay.prototype.onAdd = _onAdd;\n  Overlay.prototype.draw = _draw;\n  Overlay.prototype.remove = _remove;\n  Overlay.prototype.onRemove = _onRemove;\n\n  function _onAdd(){\n    this.getPanes().mapPane.appendChild(this.iframe);\n  }\n  function _draw(){\n    var iframe = this.iframe;\n\n    var proj = this.getProjection();\n    var left = proj.fromLatLngToDivPixel(this.west);\n    var right = proj.fromLatLngToDivPixel(this.east);\n    var wwidth = proj.getWorldWidth();\n    iframe.style.left = left.x + 'px';\n    iframe.style.top = left.y + 'px';\n    var rate = ((right.x - left.x + wwidth) % wwidth) / IFRAME_SIZE;\n    ['WebkitT', 'MozT', 'MsT', 'OT', 't'].forEach(function(x){\n      iframe.style[x + 'ransform'] = 'scale(' + rate + ', ' + rate + ')';\n    });\n  }\n  function _remove(){\n    this.setMap(null);\n  }\n  function _onRemove(){\n    this.iframe.parentNode.removeChild(this.iframe);\n  }\n})();"},"html":{"language":"html","content":"<script src=\"http://maps.google.com/maps/api/js?sensor=false\"></script>\n<div id=\"map_canvas\"></div>"},"css":{"language":"css","content":"html, body {\n  margin: 0;\n  height: 100%;\n}\n#map_canvas {\n  width: 100%;\n  height: 100%;\n}"},"published":"2011-07-15T01:51:44"}